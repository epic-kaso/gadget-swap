var app=angular.module("AdminApp",["ui.select","ngSanitize","ui.bootstrap","ui.router","ngAnimate","ngResource","angular-loading-bar","adminApp.directives","adminApp.services","ngCookies"]);app.config(["$urlRouterProvider","$stateProvider",function(e,t){t.state("devices",{url:"/devices","abstract":!0,templateUrl:"partials/device_models/dashboard.html",controller:function(){},resolve:{active:["$rootScope",function(e){e.active_nav="devices"}]}}),t.state("devices.search",{url:"/search?q",templateUrl:"partials/device_models/search.html",controller:["$scope","result","$stateParams",function(e,t,r){console.log(t),e.result=t,e.search=r.q}],resolve:{result:["$stateParams","DevicesServ",function(e,t){return t.query({q:e.q})}],hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("devices.menu",{url:"/menu",templateUrl:"partials/device_models/menu.html",controller:function(){},resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("devices.add",{url:"/add",templateUrl:"partials/device_models/add.html",resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],DeviceBrands:["DeviceBrandsServ",function(e){return e.query({only:!0})}]},controller:["$scope","ImageFetcher","DeviceBrands",function(e,t,r){function a(){e.sizes_string=e.sizes.join()}e.models=r,e.sizes=[],e.sizes_string="",e.baseLinePrice={},e.baseLinePriceString="",e.images=[],e.fetchImages=function(r){var a=t.fetch(r);a.then(function(t){e.images=t})},e.addToSizes=function(t){e.sizes.push(t),e.device_size=null,a()},e.removeSize=function(t){e.sizes.splice(t,1),a()},e.updateBaseLineString=function(){var t=[];angular.forEach(e.baseLinePrice,function(e,r){t.push(""+r+": "+e)}),e.baseLinePriceString=t.join()}}]}),t.state("devices.list",{url:"/list",templateUrl:"partials/device_models/list.html",resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],Devices:["DevicesServ",function(e){return e.query({})}]},controller:["$scope","DevicesServ","Devices",function(e,t,r){e.models=r,e.deleteItem=function(e){t["delete"]({id:e},function(){location.reload()},function(e){alert(e)})}}]}),t.state("device_brands",{url:"/device_brands","abstract":!0,templateUrl:"partials/device_brands/dashboard.html",controller:function(){},resolve:{active:["$rootScope",function(e){e.active_nav="device_brands"}]}}),t.state("device_brands.search",{url:"/search?q",templateUrl:"partials/device_brands/search.html",controller:["$scope","result","$stateParams",function(e,t,r){console.log(t),e.result=t,e.search=r.q}],resolve:{result:["$stateParams","DeviceBrandsServ",function(e,t){return t.query({q:e.q})}],hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("device_brands.menu",{url:"/menu",templateUrl:"partials/device_brands/menu.html",controller:function(){},resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("device_brands.add",{url:"/add",templateUrl:"partials/device_brands/add.html",resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]},controller:["$scope","ImageFetcher",function(e,t){e.fetchImages=function(r){var a=t.fetch(r);a.then(function(t){e.images=t})}}]}),t.state("device_brands.list",{url:"/list",templateUrl:"partials/device_brands/list.html",resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],DeviceBrands:["DeviceBrandsServ",function(e){return e.query({only:!0})}]},controller:["$scope","DeviceBrandsServ","DeviceBrands",function(e,t,r){e.brands=r,e.deleteItem=function(e){t["delete"]({id:e},function(){location.reload()},function(e){alert(e)})}}]}),t.state("networks",{url:"/networks","abstract":!0,templateUrl:"partials/networks/dashboard.html",controller:function(){},resolve:{active:["$rootScope",function(e){e.active_nav="networks"}]}}),t.state("networks.search",{url:"/search?q",templateUrl:"partials/networks/search.html",controller:["$scope","result","$stateParams",function(e,t,r){console.log(t),e.result=t,e.search=r.q}],resolve:{result:["$stateParams","NetworksServ",function(e,t){return t.query({q:e.q})}],hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("networks.menu",{url:"/menu",templateUrl:"partials/networks/menu.html",controller:function(){},resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("networks.add",{url:"/add",templateUrl:"partials/networks/add.html",resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]},controller:["$scope","ImageFetcher",function(e,t){e.fetchImages=function(r){var a=t.fetch(r);a.then(function(t){e.images=t})}}]}),t.state("networks.list",{url:"/list",templateUrl:"partials/networks/list.html",resolve:{Networks:["NetworksServ",function(e){return e.query({})}],hasHistory:["$rootScope",function(e){e.hasHistory=!0}]},controller:["$scope","Networks","NetworksServ",function(e,t,r){e.networks=t,e.deleteItem=function(e){r["delete"]({id:e},function(){location.reload()},function(e){alert(e)})}}]}),t.state("ticket",{url:"/ticket","abstract":!0,templateUrl:"partials/ticket/dashboard.html",controller:function(){},resolve:{active:["$rootScope",function(e){e.active_nav="ticket"}]}}),t.state("ticket.menu",{url:"/menu",templateUrl:"partials/ticket/menu.html",controller:["$scope","Tickets",function(e,t){e.tickets=t}],resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],Tickets:["TicketServ",function(e){return e.query({limit:6})}]}}),t.state("ticket.list",{url:"/list",templateUrl:"partials/ticket/list.html",controller:["$scope","Tickets","TicketServ",function(e,t,r){e.tickets=t,e.deleteItem=function(e){r["delete"]({id:e},function(){location.reload()},function(e){alert(e)})}}],resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],Tickets:["TicketServ",function(e){return e.query()}]}}),t.state("ticket.add",{url:"/add",templateUrl:"partials/ticket/add/base.html",controller:function(){},resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("ticket.add.stepOne",{url:"/step-one",templateUrl:"partials/ticket/add/step-one.html",controller:["$scope","TicketServ","$state",function(e,t,r){function a(e){r.go("ticket.add.stepTwo",{id:e})}e.createTicket=function(e){t.save(e,function(e){a(e.id),console.log(e)},function(e){alert("failed"),console.log(e)})}}],resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("ticket.add.stepTwo",{url:"/step-two/{id}",templateUrl:"partials/ticket/add/step-two.html",controller:["$scope","Ticket","$state",function(e,t,r){function a(e){var t={ready:!0};return angular.forEach(e,function(e){"no"==e&&(this.ready=!1)},t),t.ready}function o(t){e.activeNextButton=t,e.message=t?"Ok, proceed.":"Sorry, Device doesn't Qualify to Continue"}e.test={deviceBoot:"",callUnlock:"",wirelessConnection:"",icloudConnection:""},e.activeNextButton=!1,e.$watch("test",function(e){console.log("test change"),console.log(e);var t=a(e);o(t)},!0),e.next=function(){r.go("ticket.add.stepThree",{id:t.id})}}],resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],Ticket:["$state","$stateParams",function(e,t){return{id:t.id}}]}}),t.state("ticket.add.stepThree",{url:"/step-three/{id}",templateUrl:"partials/ticket/add/step-three.html",controller:["$scope","GradeDeviceServ","$state","Ticket","TicketServ",function(e,t,r,a,o){e.test={touchScreen:{rating:"",weight:.625},lcdScreen:{rating:"",weight:.625},deviceCasing:{rating:"",weight:.625},deviceKeypad:{rating:"",weight:.25},deviceCamera:{rating:"",weight:.25},deviceEarPiece:{rating:"",weight:.125},deviceSpeaker:{rating:"",weight:.125},deviceEarphoneJack:{rating:"",weight:.125},deviceChargingPort:{rating:"",weight:.25}},e.$watch("test",function(r){console.log("test change"),console.log(r),e.grade=t.getGrade(r),console.log("Grade:"+e.grade)},!0),e.next=function(){a.device_grade=e.grade,o.update({id:a.id},a),r.go("ticket.add.final",{id:a.id,grade:e.grade})}}],resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],Ticket:["TicketServ","$state","$stateParams",function(e,t,r){return e.get({id:r.id})}]}}),t.state("ticket.add.final",{url:"/final/{id}/{grade}",templateUrl:"partials/ticket/add/final.html",controller:["$scope","Ticket","$state","$stateParams",function(e,t,r,a){e.grade=a.grade||t.device_grade,e.next=function(){r.go("ticket.evaluate",{id:t.id,grade:e.grade})}}],resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],Ticket:["TicketServ","$state","$stateParams",function(e,t,r){return e.get({id:r.id})}]}}),t.state("ticket.evaluate",{url:"/evaluate/{id}/{grade}",templateUrl:"partials/ticket/evaluation/evaluation.html",controller:["$scope","$stateParams","$filter"," Networks","Ticket","TicketServ","DeviceBrandsServ","GadgetEvaluationReward","$state",function(e,t,r,a,o,i,n,s,c){function l(e,t){o.gadget_id=e.device.id,o.size_id=e.size,o.network_id=e.network,o.reward=t,i.update({id:o.id},o)}e.ticket=o,e.selected={grade:t.grade||o.device_grade},e.networks=a,e.clear=function(){e.person.selected=void 0,e.address.selected=void 0,e.country.selected=void 0},e.brand={},e.refreshBrands=function(t){n.query({},function(t){console.log(t),e.device_brands=t})},e.device={},e.refreshDevices=function(t){e.devices=r("filter")(e.brand.selected.gadgets,{model:t})},e.$watch("brand.selected",function(t){console.log("brand changed"),e.selected.brand=t}),e.$watch("device.selected",function(t){console.log("device changed"),e.selected.device=t}),e.next=function(){var t=s.calculate(e.selected);l(e.selected,t),c.go("ticket.reward",{id:o.id})},e.goHome=function(){c.go("ticket.menu")}}],resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}],Ticket:["TicketServ","$state","$stateParams",function(e,t,r){return e.get({id:r.id})}],Networks:["NetworksServ",function(e){return e.query({})}]}}),t.state("ticket.reward",{url:"/reward/{id}",templateUrl:"partials/ticket/evaluation/reward.html",controller:["$scope","Ticket","TicketServ","GadgetEvaluationReward","Airtel","$state",function(e,t,r,a,o,i){function n(){t.port_to_airtel=e.portToAirtel,r.update({id:t.id},t)}e.reward=a.getLastReward(),e.ticket=t,e.airtel=o,e.goHome=function(){i.go("ticket.menu")},e.next=function(){n(),i.go("ticket.accept-terms",{id:t.id})}}],resolve:{Airtel:["GadgetEvaluationReward",function(e){return e.fetchAirtelBonus()}],hasHistory:["$rootScope",function(e){e.hasHistory=!0}],Ticket:["TicketServ","$state","$stateParams",function(e,t,r){return e.get({id:r.id})}]}}),t.state("ticket.accept-terms",{url:"/accept-terms/{id}",templateUrl:"partials/ticket/evaluation/terms.html",controller:["$scope","$stateParams","$state",function(e,t,r){e.next=function(){r.go("ticket.review-ticket",{id:t.id})}}],resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("ticket.review-ticket",{url:"/review/{id}",templateUrl:"partials/ticket/evaluation/review.html",controller:["$scope","Ticket","TicketServ","$state","MailServ",function(e,t,r,a,o){e.ticket=t,e.next=function(){t.discount_voucher_code=e.ticket.discount_voucher_code,r.update({id:t.id},t),o.save({ticket_id:t.id},function(e){console.log(e)}),a.go("ticket.all-done")}}],resolve:{Ticket:["TicketServ","$state","$stateParams",function(e,t,r){return e.get({id:r.id})}],hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("ticket.all-done",{url:"/done",templateUrl:"partials/ticket/done.html",controller:function(){},resolve:{hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("ticket.search",{url:"/search?q",templateUrl:"partials/ticket/search.html",controller:["$scope","result","$stateParams",function(e,t,r){console.log(t),e.result=t,e.search=r.q}],resolve:{result:["$stateParams","TicketServ",function(e,t){return t.query({q:e.q})}],hasHistory:["$rootScope",function(e){e.hasHistory=!0}]}}),t.state("config",{url:"/config",templateUrl:"partials/config/form.html",controller:function(){},resolve:{active:["$rootScope",function(e){e.active_nav="config"}]}}),e.otherwise("/ticket/menu")}]),app.config(["$httpProvider",function(e){var t=["$rootScope","$location","$q",function(e,t,r){var a=function(e){return e},o=function(e){return(e.status=401)&&(delete sessionStorage.authenticated,location.href=t.host()+"/auth/login"),r.reject(e)};return function(e){return e.then(a,o)}}];e.interceptors.push(t)}]),app.factory("sessionInjector",[function(){var e={request:function(e){return e.headers["X-Requested-With"]="XMLHttpRequest",e}};return e}]),app.config(["$httpProvider",function(e){e.interceptors.push("sessionInjector")}]),app.run(["$http","$rootScope","CSRF_TOKEN","PreloadTemplates",function(e,t,r,a){a.run(),t.CSRF_TOKEN=r,e.defaults.headers.common.csrf_token=r}]);var app=angular.module("adminApp.directives",[]);app.directive("backButton",function(){return{restrict:"EA",template:'<a class="btn base-resize search-btn back-btn" href=""><span class="fa fa-chevron-left"></span></a>',link:function(e,t){t.click(function(e){window.history.back(),e.preventDefault()})}}});var app=angular.module("adminApp.services",[]);app.factory("TicketServ",["$resource","URLServ",function(e){return e("/resources/ticket/:id",{id:"@id"},{update:{method:"PUT"}})}]),app.factory("DeviceBrandsServ",["$resource","URLServ",function(e){return e("/resources/device_makers/:id",{id:"@id"},{update:{method:"PUT"}})}]),app.factory("DevicesServ",["$resource","URLServ",function(e){return e("/resources/devices/:id",{id:"@id"},{update:{method:"PUT"}})}]),app.factory("MailServ",["$resource",function(e){return e("/resources/mail",null)}]),app.factory("NetworksServ",["$resource","URLServ",function(e){return e("/resources/networks/:id",{id:"@id"},{update:{method:"PUT"}})}]),app.factory("URLServ",["$rootScope",function(e){return{getResourceUrlFor:function(t){return e.data.resources[t]}}}]),app.factory("GadgetEvaluationReward",["NetworksServ","$cookieStore",function(e,t){function r(e,t){var r=0;return console.log("Device --reward"),console.log(e),angular.forEach(e.base_line_prices,function(e){e.id==t&&(r=parseInt(e.value))}),r}function a(e,t,r){switch(console.log(r),console.log(e.brand.normal_condition),console.log(e.brand),console.log(t),t){case"A":return parseFloat(parseInt(e.brand.normal_condition)/100)*r;case"B":return parseFloat(parseInt(e.brand.scratched_condition)/100)*r;case"C":return parseFloat(parseInt(e.brand.bad_condition)/100)*r}}var o={result:""};return{calculate:function(e){return o.result=a(e,e.grade,r(e.device,e.size)),console.log(o.result),t.put("last-reward",o.result),o.result},getLastReward:function(){return t.get("last-reward")},fetchAirtelBonus:function(){var t=e.get({q:"airtel"});return t}}}]),app.factory("GradeDeviceServ",["$rootScope",function(){function e(e){var t={gradePoint:0};return angular.forEach(e,function(e){""!=e.rating&&(this.gradePoint+=parseInt(e.rating)*e.weight)},t),t.gradePoint}function t(e){var t=parseFloat(e);return t>=r.A?"A":t>=r.B?"B":"C"}var r={A:8.1,B:5.85};return{getGrade:function(r){var a=e(r);return t(a)}}}]),app.factory("PreloadTemplates",["$templateCache","$http",function(e,t){var r=["partials/ticket/menu.html","partials/networks/menu.html","partials/device_models/menu.html","partials/device_brands/menu.html","partials/ticket/dashboard.html","partials/networks/dashboard.html","partials/device_models/dashboard.html","partials/device_brands/dashboard.html","partials/networks/add.html","partials/device_models/add.html","partials/device_brands/add.html","partials/networks/list.html","partials/device_models/list.html","partials/device_brands/list.html","partials/ticket/evaluation/evaluation.html","partials/ticket/evaluation/review.html","partials/ticket/evaluation/reward.html","partials/ticket/evaluation/terms.html","partials/ticket/done.html","partials/ticket/search.html","partials/device_models/search.html","partials/device_brands/search.html","partials/networks/search.html","partials/ticket/list.html","partials/ticket/add/base.html","partials/ticket/add/step-one.html","partials/ticket/add/step-two.html","partials/ticket/add/step-three.html","partials/ticket/add/final.html"];return{run:function(){r.forEach(function(r){t.get(r,{cache:e})})}}}]),app.factory("ImageFetcher",["$http","$q",function(e,t){var r="https://www.googleapis.com/customsearch/v1?key=AIzaSyAJ_8QtWECvWTcrukqvfLmRWdARJ2bI2rk&cx=011505858740112002603:dap5yb7naau&q=";return{fetch:function(a){var o=[],i=t.defer();return e.get(r+encodeURI(a)).then(function(e){console.log(e.data),e.data.items.forEach(function(e){if(angular.isDefined(e.pagemap)){var t=e.pagemap.cse_image;angular.isDefined(t)&&angular.isArray(t)?t.forEach(function(e){o.push(e)}):angular.isDefined(t)&&angular.isObject(t)&&o.push(t)}}),console.log(o),i.resolve(o)},function(e){console.log(e),i.reject(e)}),i.promise}}}]);